--CUSTO DE DEVOLUCAO DE CLIENTE
SELECT D2_CUSTO1,D1_CUSTO,D2_QUANT,*
--UPDATE A SET A.D1_CUSTO=(B.D2_CUSTO1/D2_QUANT)*D1_QUANT
FROM SD1010 A
INNER JOIN SD2010 B ON B.D_E_L_E_T_='' AND B.D2_FILIAL=A.D1_FILORI AND B.D2_DOC=A.D1_NFORI AND B.D2_SERIE=A.D1_SERIORI AND B.D2_ITEM=A.D1_ITEMORI
WHERE	A.D_E_L_E_T_=''
		AND A.D1_EMISSAO BETWEEN '20200601' AND '20200630'
		AND A.D1_TIPO='D'
		AND A.D1_CUSTO!=(B.D2_CUSTO1/D2_QUANT)*D1_QUANT

--RETORNO DE NOTAS FISCAIS DE BENEFICIAMENTO
SELECT D2_CUSTO1,D1_CUSTO,D2_QUANT,*
--UPDATE A SET A.D1_CUSTO=(B.D2_CUSTO1/D2_QUANT)*D1_QUANT
FROM SD1010 A
INNER JOIN SD2010 B ON B.D_E_L_E_T_='' AND B.D2_FILIAL=A.D1_FILIAL AND B.D2_DOC=A.D1_NFORI AND B.D2_SERIE=A.D1_SERIORI AND B.D2_ITEM=A.D1_ITEMORI
WHERE	A.D_E_L_E_T_=''
		AND A.D1_DTDIGIT BETWEEN '20200601' AND '20200630'
		AND A.D1_TIPO='B'
		AND A.D1_CUSTO!=B.D2_CUSTO1

--DEVOLUÇÃO PARA FORNECEDOR
SELECT D2_CUSTO1,(B.D1_CUSTO/D1_QUANT)*D2_QUANT,D1_CUSTO,D2_QUANT,D1_QUANT,B.D1_FILIAL,A.D2_FILIAL, B.D1_DOC,A.D2_NFORI,B.D1_SERIE,A.D2_SERIORI, B.D1_ITEM,A.D2_ITEMORI,A.D2_CLIENTE,B.D1_FORNECE
--UPDATE A SET A.D2_CUSTO1=(B.D1_CUSTO/D1_QUANT)*D2_QUANT
FROM SD2010 A
INNER JOIN SD1010 B ON B.D_E_L_E_T_='' AND B.D1_FILIAL=A.D2_FILIAL AND B.D1_DOC=A.D2_NFORI AND B.D1_SERIE=A.D2_SERIORI AND B.D1_ITEM=A.D2_ITEMORI AND B.D1_FORNECE=A.D2_CLIENTE AND B.D1_LOJA=A.D2_LOJA
WHERE	A.D_E_L_E_T_=''
		AND A.D2_EMISSAO BETWEEN '20200601' AND '20200630'
		AND A.D2_TIPO='D'
		AND A.D2_CUSTO1!=(B.D1_CUSTO/D1_QUANT)*D2_QUANT